#!/usr/bin/env node

(async () => {
    const { join } = require("path");
    const verify = require("..");

    const projectDir = process.env.INIT_CWD || process.cwd();
    const configPath =  process.env.npm_config_path;

    if (!configPath) {
        console.error("You must specify configuration file path!");
        process.exit(1);
    }

    const configFullPath = configPath.startsWith(".") ?
        join(projectDir, configPath) :
        configPath;
    const config = require(configFullPath);

    const { webpackVersion: version, webpackPath: path } = config;
    if (version || path) {
        await verify.installNsWebpack({ version, path });
        await verify.addHelperScripts();
    }

    const { updateWebpack } = config;
    if (updateWebpack) {
        const options = Object.keys(updateWebpack)
            .filter(o => updateWebpack[o]);

        await verify.update(options);
    }
})();

